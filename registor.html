<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml"
    href="data:image/png;base64,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" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500&family=Roboto:wght@500&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600&family=Roboto:wght@500&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700&family=Roboto:wght@500&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/media.css">
  <title>Personal Area</title>
  <style>
    form input {
      color: white;
      background-color: #181818;
    }

    #vihod {
      border-bottom-left-radius: 25px;
    }

    #udalit {
      border-bottom-right-radius: 25px;
    }

    .backend {
      position: fixed;
      top: 20px;
      left: 20px;
      width: 50px;
      filter: invert(1);
      height: 50px;
      z-index: 100000000000;
      border: 1px solid #181818;
      border-radius: 50%;
      cursor: pointer;
    }
  </style>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DMCD2K8C2Y"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-DMCD2K8C2Y');
  </script>
</head>
<!-- Google tag (gtag.js) -->

<body style="background-color: #181818;">
  <img src="https://cdn0.iconfinder.com/data/icons/typicons-2/24/arrow-back-256.png" class="backend">
  <div class="user_page_block container">
    <div class="user_page">
      <div class="avatar" style="position: relative;">
        <input type="file" id="myFile" style="outline: none; position:absolute; cursor: pointer;" name="filename"
          class="fli">
        <img src="https://cdn2.iconfinder.com/data/icons/user-interface-169/32/about-256.png" id="output" alt="">
      </div>
      <div class="user_settings_blocks">
        <h1 style="color: white;" class="adapt_950">Ваш профиль</h1>
        <form class="user_settings">
          <input type="text" placeholder="Имя" class="name_in" required minlength="4" maxlength="100">
          <input type="text" placeholder="Пароль" class="pass_in" required minlength="8" maxlength="100">
          <input type="email" placeholder="Адресс электронной почты" required maxlength="100" class="email_in">
          <input type="submit" value="Сохранить" class="violet">
        </form>
        <div class="btn-double-block">
          <button class="bad-btn" id="vihod" onclick="leave">Выйти</button>
          <button class="bad-btn" id="udalit">Удалить аккаунт</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    let backend = document.querySelector('.backend')
    let inp_text = document.querySelector('.name_in')
    backend.onclick = () => {
      location.assign("/index.html")
    }
    let inp_password = document.querySelector('.pass_in')
    let inp_email = document.querySelector('.email_in')
    let change_img = false
    let obj = {}
    let arr = null
    let permission = true
    obj = JSON.parse(localStorage.getItem('account'))
    inp_text.value = obj.name
    inp_password.value = obj.password
    inp_email.value = obj.email
    let form = document.querySelector('form')
    fetch('https://ayub-market-default-rtdb.firebaseio.com/user.json')
      .then(res => res.json())
      .then(data => {
        arr = data
        let foundObject2 = arr.find(function (item) {
          return item.email === obj.email;
        });
        if (foundObject2.image != undefined) {
          output.src = foundObject2.image
        } else {
          output.style.filter = 'invert(1)'
        }
      })
    form.onsubmit = (e) => {
      e.preventDefault()
      if (inp_email.value != obj.email || inp_text.value != obj.name || inp_password.value != obj.password || change_img != false) {
        permission = true
        let foundObject = arr.find(function (item) {
          return item.email === obj.email;
        });
        for (let item of arr) {
          if (item.email == inp_email.value && foundObject.email != inp_email.value) {
            permission = false
            alert("Аккаунт с такой почтой уже занят !")
          }
        }
        if (permission == true) {
          let obj = {
            name: inp_text.value,
            password: inp_password.value,
            email: inp_email.value,
            image: output.src
          }
          let index = arr.findIndex(function (user) {
            return user.email === foundObject.email;
          });
          if (index !== -1) {
            arr[index] = obj;
          }
          console.log(arr)
          fetch(`https://ayub-market-default-rtdb.firebaseio.com/user.json`, {
            method: "PUT",
            headers: {
              "Content-Type": 'application/json.charset=utf-8'
            },
            body: JSON.stringify(arr)
          })
          localStorage.setItem('account', JSON.stringify(obj))
          setTimeout(() => {
            location.assign("/index.html")
          }, 1500)
        }
      } else {
        alert("Не было внесено никаких иземенений!")
      }
    }
    function leave_account() {
      localStorage.setItem('account', 'havent')
      setTimeout(() => {
        location.assign("/index.html")
      }, 1500)
    }
    function delete_account(email_acc) {
      arr = arr.filter(obj => obj.email !== email_acc)
      fetch(`https://ayub-market-default-rtdb.firebaseio.com/user.json`, {
        method: "PUT",
        headers: {
          "Content-Type": 'application/json.charset=utf-8'
        },
        body: JSON.stringify(arr)
      })
        .then(res => res.json())
      leave_account()
    }
    let vihod = document.querySelector('#vihod')
    let udalit = document.querySelector('#udalit')
    vihod.addEventListener('click', leave_account)
    udalit.onclick = () => {
      let foundObject = arr.find(function (item) {
        return item.email === obj.email;
      });
      delete_account(foundObject.email)
    }

    let output = document.querySelector('#output')
    let file = document.querySelector('#myFile')
    function image(inp_file, src_image) {
      inp_file.addEventListener("change", function () {
        const FDATA = new FormData();
        let imgFile = inp_file.files[0]
        FDATA.append('file', imgFile);
        FDATA.append('upload_preset', 'xoj8fxfk');
        fetch('https://api.cloudinary.com/v1_1/dubgmfkfc/image/upload', {
          method: 'POST',
          body: FDATA
        })
          .then(response => response.json())
          .then(data => {
            src_image.src = data.url
            output.style.filter = 'invert(0)'
            change_img = true
          })
      })
    }
    image(file, output)
  </script>
</body>

</html>